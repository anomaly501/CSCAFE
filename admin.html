<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="DENY" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <title>Admin Portal | cscafe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <script>
        tailwind.config = { theme: { extend: { colors: { navy: '#0b1a2e', navyLight: '#112240', slate: '#8892b0', accent: '#38bdf8', surface: '#f8fafc', surfaceAlt: '#f1f5f9' }, fontFamily: { sans: ['Inter', 'sans-serif'] } } } }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif
        }

        .sidebar-link.active {
            background: rgba(56, 189, 248, .1);
            color: #38bdf8;
            border-right: 3px solid #38bdf8
        }

        .modal-overlay {
            background: rgba(0, 0, 0, .5);
            backdrop-filter: blur(4px)
        }

        .toast {
            animation: slideIn .3s ease, fadeOut .3s ease 2.7s forwards
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1
            }

            to {
                opacity: 0
            }
        }

        :focus-visible {
            outline: 2px solid #38bdf8;
            outline-offset: 2px;
            border-radius: 4px
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 antialiased">

    <!-- ===== LOGIN ===== -->
    <div id="loginView" class="min-h-screen flex items-center justify-center bg-navy">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-8">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-extrabold text-navy">CS<span class="text-accent">CAFE</span></h1>
                <p class="text-sm text-gray-400 mt-1">Admin Portal</p>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input type="text" value="admin"
                        class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="loginPass" placeholder="Enter password"
                        class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <p id="loginError" class="hidden text-xs text-red-500">Invalid password.</p>
                <button type="submit"
                    class="w-full bg-navy text-white font-semibold py-2.5 rounded-lg hover:bg-navyLight transition-colors">Sign
                    In</button>

            </form>
        </div>
    </div>



    <!-- ===== DASHBOARD ===== -->
    <div id="dashView" class="hidden min-h-screen flex">

        <!-- Sidebar -->
        <aside class="w-60 bg-navy text-white flex-shrink-0 flex flex-col hidden md:flex">
            <div class="p-5 border-b border-white/10">
                <h1 class="text-xl font-extrabold">CS<span class="text-accent">CAFE</span></h1>
                <p class="text-[10px] text-slate mt-0.5 uppercase tracking-widest">Admin Console</p>
            </div>
            <nav class="flex-1 py-4 space-y-1 px-3">
                <button onclick="switchTab('dashboard')"
                    class="sidebar-link active w-full text-left flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors hover:bg-white/5"
                    data-tab="dashboard">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                    </svg>
                    Dashboard
                </button>
                <button onclick="switchTab('updates')"
                    class="sidebar-link w-full text-left flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors hover:bg-white/5"
                    data-tab="updates">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                    </svg>
                    Updates
                </button>
                <button onclick="switchTab('deadlines')"
                    class="sidebar-link w-full text-left flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors hover:bg-white/5"
                    data-tab="deadlines">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Deadlines
                </button>
                <button onclick="switchTab('resources')"
                    class="sidebar-link w-full text-left flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors hover:bg-white/5"
                    data-tab="resources">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Resources
                </button>
                <button onclick="switchTab('links')"
                    class="sidebar-link w-full text-left flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors hover:bg-white/5"
                    data-tab="links">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                    </svg>
                    Links
                </button>
            </nav>
            <div class="p-3 border-t border-white/10">
                <button onclick="logout()"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-red-300 hover:bg-red-900/30 transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Logout
                </button>
            </div>
        </aside>

        <!-- Main -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Bar -->
            <header class="bg-white border-b border-gray-100 px-6 py-3 flex justify-between items-center flex-shrink-0">
                <div class="flex items-center gap-3">
                    <button class="md:hidden text-gray-600"
                        onclick="document.querySelector('aside').classList.toggle('hidden')">☰</button>
                    <h2 id="pageTitle" class="text-lg font-bold text-gray-800">Dashboard</h2>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-400">Welcome, Admin</span>
                    <div
                        class="w-8 h-8 rounded-full bg-navy text-white flex items-center justify-center text-xs font-bold">
                        A</div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-y-auto p-6 bg-surface">

                <!-- TAB: Dashboard Overview -->
                <div id="tab-dashboard" class="tab-content space-y-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-white rounded-xl border border-gray-100 p-5">
                            <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Total Updates</p>
                            <p class="text-3xl font-bold text-navy" id="statUpdates">2</p>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-100 p-5">
                            <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Active Deadlines</p>
                            <p class="text-3xl font-bold text-accent" id="statDeadlines">1</p>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-100 p-5">
                            <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Resources</p>
                            <p class="text-3xl font-bold text-green-600" id="statResources">1</p>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-100 p-5">
                            <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Quick Links</p>
                            <p class="text-3xl font-bold text-purple-600" id="statLinks">0</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 p-6">
                        <h3 class="font-bold text-gray-800 mb-3">Quick Actions</h3>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="switchTab('updates');openModal('update')"
                                class="bg-navy text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-navyLight transition-colors">+
                                New Update</button>
                            <button onclick="switchTab('deadlines');openModal('deadline')"
                                class="bg-accent text-navy px-4 py-2 rounded-lg text-sm font-medium hover:bg-accent/80 transition-colors">+
                                New Deadline</button>
                            <button onclick="switchTab('resources');openModal('resource')"
                                class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-700 transition-colors">+
                                New Resource</button>
                            <button onclick="switchTab('links');openModal('link')"
                                class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-purple-700 transition-colors">+
                                New Link</button>
                        </div>
                    </div>
                </div>

                <!-- TAB: Updates -->
                <div id="tab-updates" class="tab-content hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold">Manage Updates</h3>
                        <button onclick="openModal('update')"
                            class="bg-navy text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">+
                            Add Update</button>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-surfaceAlt text-xs text-gray-500 uppercase">
                                <tr>
                                    <th class="px-4 py-3 text-left">Title</th>
                                    <th class="px-4 py-3 text-left">Category</th>
                                    <th class="px-4 py-3 text-left">Deadline</th>
                                    <th class="px-4 py-3 text-left">Source</th>
                                    <th class="px-4 py-3 text-left">Register</th>
                                    <th class="px-4 py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="updatesBody" class="divide-y divide-gray-50"></tbody>
                        </table>
                        <p id="emptyUpdates" class="hidden text-center text-gray-400 py-8 text-sm">No updates yet. Click
                            "+ Add Update" to create one.</p>
                    </div>
                </div>

                <!-- TAB: Deadlines -->
                <div id="tab-deadlines" class="tab-content hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold">Manage Deadlines</h3>
                        <button onclick="openModal('deadline')"
                            class="bg-navy text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">+
                            Add Deadline</button>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-surfaceAlt text-xs text-gray-500 uppercase">
                                <tr>
                                    <th class="px-4 py-3 text-left">Event</th>
                                    <th class="px-4 py-3 text-left">Deadline</th>
                                    <th class="px-4 py-3 text-left">Status</th>
                                    <th class="px-4 py-3 text-left">Link</th>
                                    <th class="px-4 py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="deadlinesBody" class="divide-y divide-gray-50"></tbody>
                        </table>
                        <p id="emptyDeadlines" class="hidden text-center text-gray-400 py-8 text-sm">No deadlines yet.
                        </p>
                    </div>
                </div>

                <!-- TAB: Resources -->
                <div id="tab-resources" class="tab-content hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold">Manage Resources</h3>
                        <button onclick="openModal('resource')"
                            class="bg-navy text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">+
                            Add Resource</button>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-surfaceAlt text-xs text-gray-500 uppercase">
                                <tr>
                                    <th class="px-4 py-3 text-left">Name</th>
                                    <th class="px-4 py-3 text-left">Type</th>
                                    <th class="px-4 py-3 text-left">Size</th>
                                    <th class="px-4 py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="resourcesBody" class="divide-y divide-gray-50"></tbody>
                        </table>
                        <p id="emptyResources" class="hidden text-center text-gray-400 py-8 text-sm">No resources yet.
                        </p>
                    </div>
                </div>

                <!-- TAB: Links -->
                <div id="tab-links" class="tab-content hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold">Manage Links</h3>
                        <button onclick="openModal('link')"
                            class="bg-navy text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">+
                            Add Link</button>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-surfaceAlt text-xs text-gray-500 uppercase">
                                <tr>
                                    <th class="px-4 py-3 text-left">Label</th>
                                    <th class="px-4 py-3 text-left">URL</th>
                                    <th class="px-4 py-3 text-left">Category</th>
                                    <th class="px-4 py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="linksBody" class="divide-y divide-gray-50"></tbody>
                        </table>
                        <p id="emptyLinks" class="hidden text-center text-gray-400 py-8 text-sm">No links yet. Click
                            "+ Add Link" to create one.</p>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- ===== MODAL: Add/Edit Update ===== -->
    <div id="modal-update" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modalUpdateTitle">Add New Update</h3>
                <button onclick="closeModal('update')"
                    class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <form id="updateForm" class="space-y-4">
                <input type="hidden" id="updateEditId" value="" />
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                    <input type="text" id="uTitle" required
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="uDesc" rows="3"
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                        <select id="uCat" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent">
                            <option value="Exams">Exams</option>
                            <option value="Internship">Internship</option>
                            <option value="Workshop">Workshop</option>
                            <option value="Notice">Notice</option>
                            <option value="Results">Results</option>
                            <option value="Contest">Contest</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Deadline *</label>
                        <input type="date" id="uDate" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tags (comma-separated)</label>
                    <input type="text" id="uTags" placeholder="e.g. Intern, AI, Free"
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Source Link</label>
                        <input type="url" id="uLink" placeholder="https://original-notice.com"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Registration Link</label>
                        <input type="url" id="uRegLink" placeholder="https://register-here.com"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closeModal('update')"
                        class="flex-1 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">Cancel</button>
                    <button type="submit"
                        class="flex-1 py-2.5 bg-navy text-white rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===== MODAL: Add/Edit Deadline ===== -->
    <div id="modal-deadline" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modalDeadlineTitle">Add New Deadline</h3>
                <button onclick="closeModal('deadline')"
                    class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <form id="deadlineForm" class="space-y-4">
                <input type="hidden" id="deadlineEditId" value="" />
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Event Name *</label>
                    <input type="text" id="dName" required
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Deadline Date *</label>
                        <input type="datetime-local" id="dDate" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status *</label>
                        <select id="dStatus" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent">
                            <option value="Open">Open</option>
                            <option value="Closing Soon">Closing Soon</option>
                            <option value="Tomorrow">Tomorrow</option>
                            <option value="Results Out">Results Out</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Registration / Source Link</label>
                    <input type="url" id="dLink" placeholder="https://registration-site.com"
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closeModal('deadline')"
                        class="flex-1 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">Cancel</button>
                    <button type="submit"
                        class="flex-1 py-2.5 bg-navy text-white rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===== MODAL: Add/Edit Resource ===== -->
    <div id="modal-resource" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modalResourceTitle">Add New Resource</h3>
                <button onclick="closeModal('resource')"
                    class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <form id="resourceForm" class="space-y-4">
                <input type="hidden" id="resourceEditId" value="" />
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Resource Name *</label>
                    <input type="text" id="rName" required
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">File Type *</label>
                        <select id="rType" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent">
                            <option value="PDF">PDF</option>
                            <option value="eBook">eBook</option>
                            <option value="ZIP">ZIP</option>
                            <option value="Video">Video</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">File Size</label>
                        <input type="text" id="rSize" placeholder="e.g. 2.4 MB"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closeModal('resource')"
                        class="flex-1 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">Cancel</button>
                    <button type="submit"
                        class="flex-1 py-2.5 bg-navy text-white rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===== MODAL: Add/Edit Link ===== -->
    <div id="modal-link" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modalLinkTitle">Add New Link</h3>
                <button onclick="closeModal('link')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <form id="linkForm" class="space-y-4">
                <input type="hidden" id="linkEditId" value="" />
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Label *</label>
                    <input type="text" id="lLabel" required placeholder="e.g. University Portal"
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">URL *</label>
                    <input type="url" id="lUrl" required placeholder="https://example.com"
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                        <select id="lCat" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent">
                            <option value="Official">Official</option>
                            <option value="Academic">Academic</option>
                            <option value="Social">Social</option>
                            <option value="Tool">Tool</option>
                            <option value="Career">Career</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <input type="text" id="lDesc" placeholder="Short note"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closeModal('link')"
                        class="flex-1 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">Cancel</button>
                    <button type="submit"
                        class="flex-1 py-2.5 bg-navy text-white rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"
        class="hidden fixed top-4 right-4 z-[100] bg-green-600 text-white px-5 py-3 rounded-xl shadow-lg text-sm font-medium">
    </div>

    <script>
        // ===== API BASE URL =====
        const API = '/api';

        // ===== DATA STORE (loaded from PostgreSQL via API) =====
        let data = { updates: [], deadlines: [], resources: [], links: [] };

        // ===== FETCH DATA FROM API =====
        async function loadAllData() {
            try {
                const [updates, deadlines, resources, links] = await Promise.all([
                    fetch(API + '/updates').then(r => r.json()),
                    fetch(API + '/deadlines').then(r => r.json()),
                    fetch(API + '/resources').then(r => r.json()),
                    fetch(API + '/links').then(r => r.json()),
                ]);
                data = { updates, deadlines, resources, links };
                renderAll();
            } catch (err) {
                console.error('Failed to load data:', err);
                showToast('⚠ Failed to connect to server. Is it running?');
            }
        }

        // ===== SECURITY UTILITIES =====
        function escapeHTML(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(String(str)));
            return div.innerHTML;
        }

        function sanitizeUrl(url) {
            if (!url) return '';
            const trimmed = url.trim();
            try {
                const parsed = new URL(trimmed);
                if (['http:', 'https:', 'mailto:'].includes(parsed.protocol)) return trimmed;
                return '';
            } catch { return ''; }
        }

        function validateLength(str, max = 500) {
            return String(str || '').slice(0, max);
        }

        // ===== SECURE LOGIN (with rate limiting) =====
        const _H = '3pyjcidqcg';
        function _k(s) {
            let a = 0xdeadbeef, b = 0x41c6ce57;
            for (let i = 0; i < s.length; i++) {
                let c = s.charCodeAt(i);
                a = Math.imul(a ^ c, 2654435761);
                b = Math.imul(b ^ c, 1597334677);
            }
            a = Math.imul(a ^ (a >>> 16), 2246822507);
            a ^= Math.imul(b ^ (b >>> 13), 3266489909);
            b = Math.imul(b ^ (b >>> 16), 2246822507);
            b ^= Math.imul(a ^ (a >>> 13), 3266489909);
            return (4294967296 * (2097151 & b) + (a >>> 0)).toString(36);
        }
        let loginAttempts = 0;
        let lockoutUntil = 0;
        const MAX_ATTEMPTS = 5;
        const LOCKOUT_MS = 30000;
        const SESSION_TIMEOUT_MS = 15 * 60 * 1000;
        let sessionTimer = null;

        function startSession() {
            clearTimeout(sessionTimer);
            sessionTimer = setTimeout(() => {
                showToast('Session expired. Please login again.');
                logout();
            }, SESSION_TIMEOUT_MS);
            ['click', 'keydown', 'mousemove', 'scroll'].forEach(evt => {
                document.addEventListener(evt, () => {
                    clearTimeout(sessionTimer);
                    sessionTimer = setTimeout(() => {
                        showToast('Session expired. Please login again.');
                        logout();
                    }, SESSION_TIMEOUT_MS);
                }, { passive: true });
            });
        }

        document.getElementById('loginForm').addEventListener('submit', e => {
            e.preventDefault();
            const errEl = document.getElementById('loginError');
            if (Date.now() < lockoutUntil) {
                const secs = Math.ceil((lockoutUntil - Date.now()) / 1000);
                errEl.textContent = `Too many attempts. Try again in ${secs}s.`;
                errEl.classList.remove('hidden');
                return;
            }
            const pass = document.getElementById('loginPass').value;
            if (_k(pass + '_cspoint_2026') === _H) {
                loginAttempts = 0;
                errEl.classList.add('hidden');
                document.getElementById('loginView').classList.add('hidden');
                document.getElementById('dashView').classList.remove('hidden');
                startSession();
                loadAllData();
            } else {
                loginAttempts++;
                if (loginAttempts >= MAX_ATTEMPTS) {
                    lockoutUntil = Date.now() + LOCKOUT_MS;
                    errEl.textContent = `Too many failed attempts. Locked for 30s.`;
                } else {
                    errEl.textContent = `Invalid password. ${MAX_ATTEMPTS - loginAttempts} attempt(s) remaining.`;
                }
                errEl.classList.remove('hidden');
            }
        });

        function logout() {
            clearTimeout(sessionTimer);
            document.getElementById('dashView').classList.add('hidden');
            document.getElementById('loginView').classList.remove('hidden');
            document.getElementById('loginPass').value = '';
        }

        // ===== TABS =====
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
            document.querySelectorAll('.sidebar-link').forEach(l => { l.classList.remove('active'); if (l.dataset.tab === tab) l.classList.add('active') });
            const titles = { dashboard: 'Dashboard', updates: 'Manage Updates', deadlines: 'Manage Deadlines', resources: 'Manage Resources', links: 'Manage Links' };
            document.getElementById('pageTitle').textContent = titles[tab] || 'Dashboard';
        }

        // ===== MODALS =====
        function openModal(type) { document.getElementById('modal-' + type).classList.remove('hidden') }
        function closeModal(type) {
            document.getElementById('modal-' + type).classList.add('hidden');
            document.getElementById(type + 'Form').reset();
            const editIdMap = { update: 'updateEditId', deadline: 'deadlineEditId', resource: 'resourceEditId', link: 'linkEditId' };
            document.getElementById(editIdMap[type]).value = '';
            const mTitleMap = { update: 'modalUpdateTitle', deadline: 'modalDeadlineTitle', resource: 'modalResourceTitle', link: 'modalLinkTitle' };
            document.getElementById(mTitleMap[type]).textContent = 'Add New ' + type.charAt(0).toUpperCase() + type.slice(1);
        }
        function showToast(msg) {
            const t = document.getElementById('toast'); t.textContent = msg; t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 3000);
        }

        // ===== CATEGORY COLORS =====
        const catColors = { Exams: 'bg-blue-50 text-blue-700', Internship: 'bg-green-50 text-green-700', Workshop: 'bg-purple-50 text-purple-700', Notice: 'bg-gray-100 text-gray-700', Results: 'bg-amber-50 text-amber-700', Contest: 'bg-rose-50 text-rose-700' };
        const statusColors = { 'Open': 'bg-green-50 text-green-700', 'Closing Soon': 'bg-red-50 text-red-700', 'Tomorrow': 'bg-amber-50 text-amber-700', 'Results Out': 'bg-blue-50 text-blue-700' };

        // ===== RENDER =====
        function renderAll() { renderUpdates(); renderDeadlines(); renderResources(); renderLinks(); updateStats(); }

        function renderUpdates() {
            const tb = document.getElementById('updatesBody');
            const empty = document.getElementById('emptyUpdates');
            if (!data.updates.length) { tb.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            tb.innerHTML = data.updates.map(u => {
                const sLink = sanitizeUrl(u.link); const sRegLink = sanitizeUrl(u.regLink); return `<tr>
        <td class="px-4 py-3 font-medium">${escapeHTML(u.title)}</td>
        <td class="px-4 py-3"><span class="px-2 py-0.5 rounded-full text-xs font-bold ${catColors[u.cat] || ''}">${escapeHTML(u.cat)}</span></td>
        <td class="px-4 py-3 text-gray-500">${escapeHTML(u.date)}</td>
        <td class="px-4 py-3">${sLink ? `<a href="${sLink}" target="_blank" rel="noopener noreferrer" class="text-accent hover:underline text-xs">View ↗</a>` : '<span class="text-gray-300 text-xs">—</span>'}</td>
        <td class="px-4 py-3">${sRegLink ? `<a href="${sRegLink}" target="_blank" rel="noopener noreferrer" class="text-green-600 hover:underline text-xs font-semibold">Register ↗</a>` : '<span class="text-gray-300 text-xs">—</span>'}</td>
        <td class="px-4 py-3 text-right space-x-2">
          <button onclick="editUpdate(${u.id})" class="text-accent hover:text-navy font-medium text-xs">Edit</button>
          <button onclick="deleteItem('updates',${u.id})" class="text-red-400 hover:text-red-600 font-medium text-xs">Delete</button>
        </td></tr>`;
            }).join('');
        }

        function renderDeadlines() {
            const tb = document.getElementById('deadlinesBody');
            const empty = document.getElementById('emptyDeadlines');
            if (!data.deadlines.length) { tb.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            tb.innerHTML = data.deadlines.map(d => {
                const sLink = sanitizeUrl(d.link); return `<tr>
        <td class="px-4 py-3 font-medium">${escapeHTML(d.name)}</td>
        <td class="px-4 py-3 text-gray-500">${escapeHTML((d.date || '').replace('T', ' '))}</td>
        <td class="px-4 py-3"><span class="px-2 py-0.5 rounded-full text-xs font-bold ${statusColors[d.status] || ''}">${escapeHTML(d.status)}</span></td>
        <td class="px-4 py-3">${sLink ? `<a href="${sLink}" target="_blank" rel="noopener noreferrer" class="text-accent hover:underline text-xs">Register ↗</a>` : '<span class="text-gray-300 text-xs">—</span>'}</td>
        <td class="px-4 py-3 text-right space-x-2">
          <button onclick="editDeadline(${d.id})" class="text-accent hover:text-navy font-medium text-xs">Edit</button>
          <button onclick="deleteItem('deadlines',${d.id})" class="text-red-400 hover:text-red-600 font-medium text-xs">Delete</button>
        </td></tr>`;
            }).join('');
        }

        function renderResources() {
            const tb = document.getElementById('resourcesBody');
            const empty = document.getElementById('emptyResources');
            if (!data.resources.length) { tb.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            tb.innerHTML = data.resources.map(r => `<tr>
        <td class="px-4 py-3 font-medium">${escapeHTML(r.name)}</td>
        <td class="px-4 py-3 text-gray-500">${escapeHTML(r.type)}</td>
        <td class="px-4 py-3 text-gray-500">${escapeHTML(r.size) || '—'}</td>
        <td class="px-4 py-3 text-right space-x-2">
          <button onclick="editResource(${r.id})" class="text-accent hover:text-navy font-medium text-xs">Edit</button>
          <button onclick="deleteItem('resources',${r.id})" class="text-red-400 hover:text-red-600 font-medium text-xs">Delete</button>
        </td></tr>`).join('');
        }

        function renderLinks() {
            const tb = document.getElementById('linksBody');
            const empty = document.getElementById('emptyLinks');
            if (!data.links.length) { tb.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            const linkCatColors = { Official: 'bg-blue-50 text-blue-700', Academic: 'bg-green-50 text-green-700', Social: 'bg-pink-50 text-pink-700', Tool: 'bg-purple-50 text-purple-700', Career: 'bg-amber-50 text-amber-700', Other: 'bg-gray-100 text-gray-700' };
            tb.innerHTML = data.links.map(l => {
                const sUrl = sanitizeUrl(l.url); return `<tr>
        <td class="px-4 py-3 font-medium">${escapeHTML(l.label)}</td>
        <td class="px-4 py-3">${sUrl ? `<a href="${sUrl}" target="_blank" rel="noopener noreferrer" class="text-accent hover:underline text-xs truncate block max-w-[200px]">${escapeHTML(l.url)}</a>` : '<span class="text-gray-300 text-xs">—</span>'}</td>
        <td class="px-4 py-3"><span class="px-2 py-0.5 rounded-full text-xs font-bold ${linkCatColors[l.cat] || ''}">${escapeHTML(l.cat)}</span></td>
        <td class="px-4 py-3 text-right space-x-2">
          <button onclick="editLink(${l.id})" class="text-accent hover:text-navy font-medium text-xs">Edit</button>
          <button onclick="deleteItem('links',${l.id})" class="text-red-400 hover:text-red-600 font-medium text-xs">Delete</button>
        </td></tr>`;
            }).join('');
        }

        function updateStats() {
            document.getElementById('statUpdates').textContent = data.updates.length;
            document.getElementById('statDeadlines').textContent = data.deadlines.length;
            document.getElementById('statResources').textContent = data.resources.length;
            document.getElementById('statLinks').textContent = data.links.length;
        }

        // ===== CRUD: UPDATES (via API) =====
        document.getElementById('updateForm').addEventListener('submit', async e => {
            e.preventDefault();
            const editId = document.getElementById('updateEditId').value;
            const item = {
                title: validateLength(document.getElementById('uTitle').value, 200),
                desc: validateLength(document.getElementById('uDesc').value, 1000),
                cat: validateLength(document.getElementById('uCat').value, 50),
                date: document.getElementById('uDate').value,
                link: sanitizeUrl(document.getElementById('uLink').value),
                regLink: sanitizeUrl(document.getElementById('uRegLink').value),
                tags: validateLength(document.getElementById('uTags').value, 500)
            };
            try {
                if (editId) {
                    await fetch(API + '/updates/' + editId, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(item) });
                    showToast('Update edited successfully!');
                } else {
                    await fetch(API + '/updates', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(item) });
                    showToast('Update added successfully!');
                }
                closeModal('update');
                await loadAllData();
            } catch (err) { console.error(err); showToast('⚠ Error saving update.'); }
        });

        function editUpdate(id) {
            const u = data.updates.find(x => x.id === id); if (!u) return;
            document.getElementById('updateEditId').value = id;
            document.getElementById('uTitle').value = u.title;
            document.getElementById('uDesc').value = u.desc || '';
            document.getElementById('uCat').value = u.cat;
            document.getElementById('uDate').value = u.date;
            document.getElementById('uLink').value = u.link || '';
            document.getElementById('uRegLink').value = u.regLink || '';
            document.getElementById('uTags').value = u.tags || '';
            document.getElementById('modalUpdateTitle').textContent = 'Edit Update';
            openModal('update');
        }

        // ===== CRUD: DEADLINES (via API) =====
        document.getElementById('deadlineForm').addEventListener('submit', async e => {
            e.preventDefault();
            const editId = document.getElementById('deadlineEditId').value;
            const item = {
                name: validateLength(document.getElementById('dName').value, 200),
                date: document.getElementById('dDate').value,
                status: validateLength(document.getElementById('dStatus').value, 50),
                link: sanitizeUrl(document.getElementById('dLink').value)
            };
            try {
                if (editId) {
                    await fetch(API + '/deadlines/' + editId, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(item) });
                    showToast('Deadline edited!');
                } else {
                    await fetch(API + '/deadlines', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(item) });
                    showToast('Deadline added!');
                }
                closeModal('deadline');
                await loadAllData();
            } catch (err) { console.error(err); showToast('⚠ Error saving deadline.'); }
        });

        function editDeadline(id) {
            const d = data.deadlines.find(x => x.id === id); if (!d) return;
            document.getElementById('deadlineEditId').value = id;
            document.getElementById('dName').value = d.name;
            document.getElementById('dDate').value = d.date;
            document.getElementById('dStatus').value = d.status;
            document.getElementById('dLink').value = d.link || '';
            document.getElementById('modalDeadlineTitle').textContent = 'Edit Deadline';
            openModal('deadline');
        }

        // ===== CRUD: RESOURCES (via API) =====
        document.getElementById('resourceForm').addEventListener('submit', async e => {
            e.preventDefault();
            const editId = document.getElementById('resourceEditId').value;
            const item = {
                name: validateLength(document.getElementById('rName').value, 200),
                type: validateLength(document.getElementById('rType').value, 50),
                size: validateLength(document.getElementById('rSize').value, 50)
            };
            try {
                if (editId) {
                    await fetch(API + '/resources/' + editId, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(item) });
                    showToast('Resource edited!');
                } else {
                    await fetch(API + '/resources', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(item) });
                    showToast('Resource added!');
                }
                closeModal('resource');
                await loadAllData();
            } catch (err) { console.error(err); showToast('⚠ Error saving resource.'); }
        });

        function editResource(id) {
            const r = data.resources.find(x => x.id === id); if (!r) return;
            document.getElementById('resourceEditId').value = id;
            document.getElementById('rName').value = r.name;
            document.getElementById('rType').value = r.type;
            document.getElementById('rSize').value = r.size || '';
            document.getElementById('modalResourceTitle').textContent = 'Edit Resource';
            openModal('resource');
        }

        // ===== CRUD: LINKS (via API) =====
        document.getElementById('linkForm').addEventListener('submit', async e => {
            e.preventDefault();
            const editId = document.getElementById('linkEditId').value;
            const item = {
                label: validateLength(document.getElementById('lLabel').value, 200),
                url: sanitizeUrl(document.getElementById('lUrl').value),
                cat: validateLength(document.getElementById('lCat').value, 50),
                desc: validateLength(document.getElementById('lDesc').value, 500)
            };
            try {
                if (editId) {
                    await fetch(API + '/links/' + editId, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(item) });
                    showToast('Link edited!');
                } else {
                    await fetch(API + '/links', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(item) });
                    showToast('Link added!');
                }
                closeModal('link');
                await loadAllData();
            } catch (err) { console.error(err); showToast('⚠ Error saving link.'); }
        });

        function editLink(id) {
            const l = data.links.find(x => x.id === id); if (!l) return;
            document.getElementById('linkEditId').value = id;
            document.getElementById('lLabel').value = l.label;
            document.getElementById('lUrl').value = l.url;
            document.getElementById('lCat').value = l.cat;
            document.getElementById('lDesc').value = l.desc || '';
            document.getElementById('modalLinkTitle').textContent = 'Edit Link';
            openModal('link');
        }

        // ===== DELETE (via API) =====
        async function deleteItem(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            try {
                await fetch(API + '/' + type + '/' + id, { method: 'DELETE' });
                showToast('Item deleted.');
                await loadAllData();
            } catch (err) { console.error(err); showToast('⚠ Error deleting item.'); }
        }
    </script>
</body>

</html>