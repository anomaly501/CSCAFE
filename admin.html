<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="DENY" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    <title>Admin Portal | CSPOINT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <script>
        tailwind.config = { theme: { extend: { colors: { navy: '#0b1a2e', navyLight: '#112240', slate: '#8892b0', accent: '#38bdf8', surface: '#f8fafc', surfaceAlt: '#f1f5f9' }, fontFamily: { sans: ['Inter', 'sans-serif'] } } } }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif
        }

        .sidebar-link.active {
            background: rgba(56, 189, 248, .1);
            color: #38bdf8;
            border-right: 3px solid #38bdf8
        }

        .modal-overlay {
            background: rgba(0, 0, 0, .5);
            backdrop-filter: blur(4px)
        }

        .toast {
            animation: slideIn .3s ease, fadeOut .3s ease 2.7s forwards
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1
            }

            to {
                opacity: 0
            }
        }

        :focus-visible {
            outline: 2px solid #38bdf8;
            outline-offset: 2px;
            border-radius: 4px
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 antialiased">

    <!-- ===== LOGIN ===== -->
    <div id="loginView" class="min-h-screen flex items-center justify-center bg-navy">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-8">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-extrabold text-navy">CS<span class="text-accent">POINT</span></h1>
                <p class="text-sm text-gray-400 mt-1">Admin Portal</p>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input type="text" value="admin"
                        class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="loginPass" placeholder="Enter password"
                        class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <p id="loginError" class="hidden text-xs text-red-500">Invalid password.</p>
                <button type="submit"
                    class="w-full bg-navy text-white font-semibold py-2.5 rounded-lg hover:bg-navyLight transition-colors">Sign
                    In</button>
                <div class="text-center mt-3">
                    <button type="button" onclick="document.getElementById('forgotModal').classList.remove('hidden')"
                        class="text-xs text-accent hover:underline font-medium">Forgot Password?</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===== FORGOT PASSWORD MODAL ===== -->
    <div id="forgotModal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-navy">Reset Password</h3>
                <button onclick="document.getElementById('forgotModal').classList.add('hidden')"
                    class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <div id="forgotStep1">
                <p class="text-sm text-gray-500 mb-4">Enter your admin email to receive a reset code.</p>
                <input type="email" id="forgotEmail" placeholder="admin@cspoint.edu"
                    class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent mb-3" />
                <button onclick="handleForgotStep1()"
                    class="w-full bg-navy text-white font-semibold py-2.5 rounded-lg hover:bg-navyLight transition-colors text-sm">Send
                    Reset Code</button>
            </div>
            <div id="forgotStep2" class="hidden">
                <p class="text-sm text-gray-500 mb-2">Enter the 4-digit code sent to your email.</p>
                <p class="text-xs text-accent mb-3 font-medium">Hint: demo code is <strong>1234</strong></p>
                <input type="text" id="forgotCode" placeholder="Enter 4-digit code" maxlength="4"
                    class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm text-center tracking-[0.5em] font-mono font-bold focus:border-accent focus:ring-1 focus:ring-accent mb-3" />
                <button onclick="handleForgotStep2()"
                    class="w-full bg-navy text-white font-semibold py-2.5 rounded-lg hover:bg-navyLight transition-colors text-sm">Verify
                    Code</button>
            </div>
            <div id="forgotStep3" class="hidden">
                <p class="text-sm text-gray-500 mb-4">Create your new password.</p>
                <input type="password" id="newPass" placeholder="New password"
                    class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent mb-3" />
                <input type="password" id="confirmPass" placeholder="Confirm password"
                    class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent mb-3" />
                <p id="forgotPassError" class="hidden text-xs text-red-500 mb-2"></p>
                <button onclick="handleForgotStep3()"
                    class="w-full bg-green-600 text-white font-semibold py-2.5 rounded-lg hover:bg-green-700 transition-colors text-sm">Reset
                    Password</button>
            </div>
            <div id="forgotSuccess" class="hidden text-center">
                <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-green-50 flex items-center justify-center">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </div>
                <p class="text-sm font-semibold text-gray-800">Password Reset Successfully!</p>
                <p class="text-xs text-gray-400 mt-1">You can now login with your new password.</p>
                <button onclick="closeForgotModal()"
                    class="mt-4 w-full bg-navy text-white font-semibold py-2.5 rounded-lg hover:bg-navyLight transition-colors text-sm">Back
                    to Login</button>
            </div>
        </div>
    </div>

    <!-- ===== DASHBOARD ===== -->
    <div id="dashView" class="hidden min-h-screen flex">

        <!-- Sidebar -->
        <aside class="w-60 bg-navy text-white flex-shrink-0 flex flex-col hidden md:flex">
            <div class="p-5 border-b border-white/10">
                <h1 class="text-xl font-extrabold">CS<span class="text-accent">POINT</span></h1>
                <p class="text-[10px] text-slate mt-0.5 uppercase tracking-widest">Admin Console</p>
            </div>
            <nav class="flex-1 py-4 space-y-1 px-3">
                <button onclick="switchTab('dashboard')"
                    class="sidebar-link active w-full text-left flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors hover:bg-white/5"
                    data-tab="dashboard">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                    </svg>
                    Dashboard
                </button>
                <button onclick="switchTab('updates')"
                    class="sidebar-link w-full text-left flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors hover:bg-white/5"
                    data-tab="updates">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                    </svg>
                    Updates
                </button>
                <button onclick="switchTab('deadlines')"
                    class="sidebar-link w-full text-left flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors hover:bg-white/5"
                    data-tab="deadlines">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Deadlines
                </button>
                <button onclick="switchTab('resources')"
                    class="sidebar-link w-full text-left flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors hover:bg-white/5"
                    data-tab="resources">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Resources
                </button>
                <button onclick="switchTab('links')"
                    class="sidebar-link w-full text-left flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors hover:bg-white/5"
                    data-tab="links">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                    </svg>
                    Links
                </button>
            </nav>
            <div class="p-3 border-t border-white/10">
                <button onclick="logout()"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-red-300 hover:bg-red-900/30 transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Logout
                </button>
            </div>
        </aside>

        <!-- Main -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Bar -->
            <header class="bg-white border-b border-gray-100 px-6 py-3 flex justify-between items-center flex-shrink-0">
                <div class="flex items-center gap-3">
                    <button class="md:hidden text-gray-600"
                        onclick="document.querySelector('aside').classList.toggle('hidden')">â˜°</button>
                    <h2 id="pageTitle" class="text-lg font-bold text-gray-800">Dashboard</h2>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-400">Welcome, Admin</span>
                    <div
                        class="w-8 h-8 rounded-full bg-navy text-white flex items-center justify-center text-xs font-bold">
                        A</div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-y-auto p-6 bg-surface">

                <!-- TAB: Dashboard Overview -->
                <div id="tab-dashboard" class="tab-content space-y-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-white rounded-xl border border-gray-100 p-5">
                            <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Total Updates</p>
                            <p class="text-3xl font-bold text-navy" id="statUpdates">2</p>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-100 p-5">
                            <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Active Deadlines</p>
                            <p class="text-3xl font-bold text-accent" id="statDeadlines">1</p>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-100 p-5">
                            <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Resources</p>
                            <p class="text-3xl font-bold text-green-600" id="statResources">1</p>
                        </div>
                        <div class="bg-white rounded-xl border border-gray-100 p-5">
                            <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Quick Links</p>
                            <p class="text-3xl font-bold text-purple-600" id="statLinks">0</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 p-6">
                        <h3 class="font-bold text-gray-800 mb-3">Quick Actions</h3>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="switchTab('updates');openModal('update')"
                                class="bg-navy text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-navyLight transition-colors">+
                                New Update</button>
                            <button onclick="switchTab('deadlines');openModal('deadline')"
                                class="bg-accent text-navy px-4 py-2 rounded-lg text-sm font-medium hover:bg-accent/80 transition-colors">+
                                New Deadline</button>
                            <button onclick="switchTab('resources');openModal('resource')"
                                class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-700 transition-colors">+
                                New Resource</button>
                            <button onclick="switchTab('links');openModal('link')"
                                class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-purple-700 transition-colors">+
                                New Link</button>
                        </div>
                    </div>
                </div>

                <!-- TAB: Updates -->
                <div id="tab-updates" class="tab-content hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold">Manage Updates</h3>
                        <button onclick="openModal('update')"
                            class="bg-navy text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">+
                            Add Update</button>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-surfaceAlt text-xs text-gray-500 uppercase">
                                <tr>
                                    <th class="px-4 py-3 text-left">Title</th>
                                    <th class="px-4 py-3 text-left">Category</th>
                                    <th class="px-4 py-3 text-left">Date</th>
                                    <th class="px-4 py-3 text-left">Source</th>
                                    <th class="px-4 py-3 text-left">Register</th>
                                    <th class="px-4 py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="updatesBody" class="divide-y divide-gray-50"></tbody>
                        </table>
                        <p id="emptyUpdates" class="hidden text-center text-gray-400 py-8 text-sm">No updates yet. Click
                            "+ Add Update" to create one.</p>
                    </div>
                </div>

                <!-- TAB: Deadlines -->
                <div id="tab-deadlines" class="tab-content hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold">Manage Deadlines</h3>
                        <button onclick="openModal('deadline')"
                            class="bg-navy text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">+
                            Add Deadline</button>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-surfaceAlt text-xs text-gray-500 uppercase">
                                <tr>
                                    <th class="px-4 py-3 text-left">Event</th>
                                    <th class="px-4 py-3 text-left">Deadline</th>
                                    <th class="px-4 py-3 text-left">Status</th>
                                    <th class="px-4 py-3 text-left">Link</th>
                                    <th class="px-4 py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="deadlinesBody" class="divide-y divide-gray-50"></tbody>
                        </table>
                        <p id="emptyDeadlines" class="hidden text-center text-gray-400 py-8 text-sm">No deadlines yet.
                        </p>
                    </div>
                </div>

                <!-- TAB: Resources -->
                <div id="tab-resources" class="tab-content hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold">Manage Resources</h3>
                        <button onclick="openModal('resource')"
                            class="bg-navy text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">+
                            Add Resource</button>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-surfaceAlt text-xs text-gray-500 uppercase">
                                <tr>
                                    <th class="px-4 py-3 text-left">Name</th>
                                    <th class="px-4 py-3 text-left">Type</th>
                                    <th class="px-4 py-3 text-left">Size</th>
                                    <th class="px-4 py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="resourcesBody" class="divide-y divide-gray-50"></tbody>
                        </table>
                        <p id="emptyResources" class="hidden text-center text-gray-400 py-8 text-sm">No resources yet.
                        </p>
                    </div>
                </div>

                <!-- TAB: Links -->
                <div id="tab-links" class="tab-content hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold">Manage Links</h3>
                        <button onclick="openModal('link')"
                            class="bg-navy text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">+
                            Add Link</button>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-surfaceAlt text-xs text-gray-500 uppercase">
                                <tr>
                                    <th class="px-4 py-3 text-left">Label</th>
                                    <th class="px-4 py-3 text-left">URL</th>
                                    <th class="px-4 py-3 text-left">Category</th>
                                    <th class="px-4 py-3 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="linksBody" class="divide-y divide-gray-50"></tbody>
                        </table>
                        <p id="emptyLinks" class="hidden text-center text-gray-400 py-8 text-sm">No links yet. Click
                            "+ Add Link" to create one.</p>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- ===== MODAL: Add/Edit Update ===== -->
    <div id="modal-update" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modalUpdateTitle">Add New Update</h3>
                <button onclick="closeModal('update')"
                    class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <form id="updateForm" class="space-y-4">
                <input type="hidden" id="updateEditId" value="" />
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                    <input type="text" id="uTitle" required
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="uDesc" rows="3"
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                        <select id="uCat" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent">
                            <option value="Exams">Exams</option>
                            <option value="Internship">Internship</option>
                            <option value="Workshop">Workshop</option>
                            <option value="Notice">Notice</option>
                            <option value="Results">Results</option>
                            <option value="Contest">Contest</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Date *</label>
                        <input type="date" id="uDate" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Source Link</label>
                        <input type="url" id="uLink" placeholder="https://original-notice.com"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Registration Link</label>
                        <input type="url" id="uRegLink" placeholder="https://register-here.com"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closeModal('update')"
                        class="flex-1 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">Cancel</button>
                    <button type="submit"
                        class="flex-1 py-2.5 bg-navy text-white rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===== MODAL: Add/Edit Deadline ===== -->
    <div id="modal-deadline" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modalDeadlineTitle">Add New Deadline</h3>
                <button onclick="closeModal('deadline')"
                    class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <form id="deadlineForm" class="space-y-4">
                <input type="hidden" id="deadlineEditId" value="" />
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Event Name *</label>
                    <input type="text" id="dName" required
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Deadline Date *</label>
                        <input type="datetime-local" id="dDate" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status *</label>
                        <select id="dStatus" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent">
                            <option value="Open">Open</option>
                            <option value="Closing Soon">Closing Soon</option>
                            <option value="Tomorrow">Tomorrow</option>
                            <option value="Results Out">Results Out</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Registration / Source Link</label>
                    <input type="url" id="dLink" placeholder="https://registration-site.com"
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closeModal('deadline')"
                        class="flex-1 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">Cancel</button>
                    <button type="submit"
                        class="flex-1 py-2.5 bg-navy text-white rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===== MODAL: Add/Edit Resource ===== -->
    <div id="modal-resource" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modalResourceTitle">Add New Resource</h3>
                <button onclick="closeModal('resource')"
                    class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <form id="resourceForm" class="space-y-4">
                <input type="hidden" id="resourceEditId" value="" />
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Resource Name *</label>
                    <input type="text" id="rName" required
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">File Type *</label>
                        <select id="rType" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent">
                            <option value="PDF">PDF</option>
                            <option value="eBook">eBook</option>
                            <option value="ZIP">ZIP</option>
                            <option value="Video">Video</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">File Size</label>
                        <input type="text" id="rSize" placeholder="e.g. 2.4 MB"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closeModal('resource')"
                        class="flex-1 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">Cancel</button>
                    <button type="submit"
                        class="flex-1 py-2.5 bg-navy text-white rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ===== MODAL: Add/Edit Link ===== -->
    <div id="modal-link" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modalLinkTitle">Add New Link</h3>
                <button onclick="closeModal('link')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <form id="linkForm" class="space-y-4">
                <input type="hidden" id="linkEditId" value="" />
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Label *</label>
                    <input type="text" id="lLabel" required placeholder="e.g. University Portal"
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">URL *</label>
                    <input type="url" id="lUrl" required placeholder="https://example.com"
                        class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                        <select id="lCat" required
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent">
                            <option value="Official">Official</option>
                            <option value="Academic">Academic</option>
                            <option value="Social">Social</option>
                            <option value="Tool">Tool</option>
                            <option value="Career">Career</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <input type="text" id="lDesc" placeholder="Short note"
                            class="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-accent focus:ring-1 focus:ring-accent" />
                    </div>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closeModal('link')"
                        class="flex-1 py-2.5 border border-gray-200 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">Cancel</button>
                    <button type="submit"
                        class="flex-1 py-2.5 bg-navy text-white rounded-lg text-sm font-semibold hover:bg-navyLight transition-colors">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"
        class="hidden fixed top-4 right-4 z-[100] bg-green-600 text-white px-5 py-3 rounded-xl shadow-lg text-sm font-medium">
    </div>

    <script>
        // ===== DATA STORE (with localStorage persistence) =====
        const DEFAULT_DATA = {
            updates: [
                { id: 1, title: 'End Semester Examination Schedule Released \u2014 Spring 2026', desc: 'Final schedule for the CSE department end-term exams has been published. Exams commence from May 15th, 2026.', cat: 'Exams', date: '2026-02-18', link: 'https://university.edu/exams/spring2026', regLink: '' },
                { id: 2, title: 'Summer Research Internship at IIT Bombay \u2014 Applications Open', desc: 'Applications are invited for the Summer Research Fellowship Program 2026. Eligible for 3rd-year B.Tech students.', cat: 'Internship', date: '2026-02-17', link: 'https://iitb.ac.in/internship', regLink: 'https://iitb.ac.in/internship/apply' },
                { id: 3, title: '3-Day Workshop on Generative AI & Large Language Models', desc: 'Hands-on workshop covering Transformers, PyTorch, and deploying LLMs. Registration closes Feb 25.', cat: 'Workshop', date: '2026-02-16', link: 'https://workshop.cse.edu/genai', regLink: 'https://workshop.cse.edu/genai/register' },
                { id: 4, title: 'GATE 2026 Results Declared \u2014 Check Scorecard Now', desc: 'IIT Delhi has released the GATE 2026 results. Candidates can download their scorecard from the official portal.', cat: 'Results', date: '2026-02-15', link: 'https://gate2026.iitd.ac.in/results', regLink: '' },
                { id: 5, title: 'Holiday Notice: University Closed for Maha Shivaratri', desc: 'All departments will remain closed on Feb 26 on account of Maha Shivaratri. Classes resume Feb 27.', cat: 'Notice', date: '2026-02-14', link: '', regLink: '' },
                { id: 6, title: 'Google Code Jam 2026 \u2014 Qualification Round Registration Open', desc: 'Register for the qualification round. Open to all participants globally. Top scorers proceed to Round 1.', cat: 'Contest', date: '2026-02-13', link: 'https://codingcompetitions.withgoogle.com/codejam', regLink: 'https://codingcompetitions.withgoogle.com/codejam/register' },
                { id: 7, title: 'Microsoft Engage 2026 \u2014 Mentorship Program Applications', desc: 'Microsoft India flagship mentorship and internship program for pre-final year students. Apply by March 10.', cat: 'Internship', date: '2026-02-12', link: 'https://microsoft.com/engage', regLink: 'https://microsoft.com/engage/apply' }
            ],
            deadlines: [
                { id: 1, name: 'GATE 2027 Registration', date: '2026-03-30T23:59', status: 'Closing Soon', link: 'https://gate2027.iitm.ac.in/register' },
                { id: 2, name: 'Google STEP Internship', date: '2026-04-15T23:59', status: 'Open', link: 'https://careers.google.com/students/step' },
                { id: 3, name: 'Hack-All-Night Contest', date: '2026-02-20T18:00', status: 'Tomorrow', link: 'https://hackallnight.dev/register' },
                { id: 4, name: 'MITACS Globalink Research', date: '2026-05-01T23:59', status: 'Open', link: 'https://mitacs.ca/globalink' },
                { id: 5, name: 'JEE Advanced 2026', date: '2026-02-10T00:00', status: 'Results Out', link: 'https://jeeadv.ac.in/results' }
            ],
            resources: [
                { id: 1, name: 'Data Structures Notes', type: 'PDF', size: '2.4 MB' },
                { id: 2, name: 'OS \u2014 Galvin 9th Ed', type: 'eBook', size: '15 MB' },
                { id: 3, name: 'Previous Year Papers (2025)', type: 'ZIP', size: '56 MB' },
                { id: 4, name: 'Algorithm Cheat Sheet', type: 'PDF', size: '500 KB' }
            ],
            links: [
                { id: 1, label: 'University Portal', url: 'https://university.edu', cat: 'Official', desc: 'Main university website' },
                { id: 2, label: 'CSE Department', url: 'https://cse.university.edu', cat: 'Academic', desc: 'Department homepage' },
                { id: 3, label: 'Placement Cell', url: 'https://placement.university.edu', cat: 'Career', desc: 'Training & placements' }
            ]
        };

        // Load from localStorage or use defaults
        let data = JSON.parse(localStorage.getItem('cspoint_data')) || JSON.parse(JSON.stringify(DEFAULT_DATA));
        // Ensure links array exists for older localStorage data
        if (!data.links) data.links = JSON.parse(JSON.stringify(DEFAULT_DATA.links));
        let nextId = JSON.parse(localStorage.getItem('cspoint_nextId')) || { updates: 8, deadlines: 6, resources: 5, links: 4 };
        if (!nextId.links) nextId.links = 4;

        function saveData() {
            localStorage.setItem('cspoint_data', JSON.stringify(data));
            localStorage.setItem('cspoint_nextId', JSON.stringify(nextId));
        }

        // ===== SECURITY UTILITIES =====
        function escapeHTML(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(String(str)));
            return div.innerHTML;
        }

        function sanitizeUrl(url) {
            if (!url) return '';
            const trimmed = url.trim();
            try {
                const parsed = new URL(trimmed);
                if (['http:', 'https:', 'mailto:'].includes(parsed.protocol)) return trimmed;
                return '';
            } catch { return ''; }
        }

        function validateLength(str, max = 500) {
            return String(str || '').slice(0, max);
        }

        async function hashPassword(pass) {
            const encoder = new TextEncoder();
            const data = encoder.encode(pass + 'cspoint_salt_2026');
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // ===== LOGIN (with hashing + rate limiting) =====
        let loginAttempts = 0;
        let lockoutUntil = 0;
        const MAX_ATTEMPTS = 5;
        const LOCKOUT_MS = 30000; // 30 seconds
        const SESSION_TIMEOUT_MS = 15 * 60 * 1000; // 15 minutes
        let sessionTimer = null;

        // Initialize password hash if not set (migrate from plaintext)
        (async () => {
            const stored = localStorage.getItem('cspoint_admin_hash');
            const CURRENT_PASS_VERSION = 'v2';
            if (!stored || localStorage.getItem('cspoint_pass_version') !== CURRENT_PASS_VERSION) {
                const hash = await hashPassword('Eldorado@123');
                localStorage.setItem('cspoint_admin_hash', hash);
                localStorage.setItem('cspoint_pass_version', CURRENT_PASS_VERSION);
                localStorage.removeItem('cspoint_admin_pass'); // remove plaintext
            }
        })();

        function startSession() {
            clearTimeout(sessionTimer);
            sessionTimer = setTimeout(() => {
                showToast('Session expired. Please login again.');
                logout();
            }, SESSION_TIMEOUT_MS);
            // Reset timer on user activity
            ['click', 'keydown', 'mousemove', 'scroll'].forEach(evt => {
                document.addEventListener(evt, () => {
                    clearTimeout(sessionTimer);
                    sessionTimer = setTimeout(() => {
                        showToast('Session expired. Please login again.');
                        logout();
                    }, SESSION_TIMEOUT_MS);
                }, { passive: true });
            });
        }

        document.getElementById('loginForm').addEventListener('submit', async e => {
            e.preventDefault();
            const errEl = document.getElementById('loginError');
            // Check lockout
            if (Date.now() < lockoutUntil) {
                const secs = Math.ceil((lockoutUntil - Date.now()) / 1000);
                errEl.textContent = `Too many attempts. Try again in ${secs}s.`;
                errEl.classList.remove('hidden');
                return;
            }
            const pass = document.getElementById('loginPass').value;
            const hash = await hashPassword(pass);
            const storedHash = localStorage.getItem('cspoint_admin_hash');
            if (hash === storedHash) {
                loginAttempts = 0;
                errEl.classList.add('hidden');
                document.getElementById('loginView').classList.add('hidden');
                document.getElementById('dashView').classList.remove('hidden');
                startSession();
                renderAll();
            } else {
                loginAttempts++;
                if (loginAttempts >= MAX_ATTEMPTS) {
                    lockoutUntil = Date.now() + LOCKOUT_MS;
                    errEl.textContent = `Too many failed attempts. Locked for 30s.`;
                } else {
                    errEl.textContent = `Invalid password. ${MAX_ATTEMPTS - loginAttempts} attempt(s) remaining.`;
                }
                errEl.classList.remove('hidden');
            }
        });

        // ===== FORGOT PASSWORD FLOW =====
        function handleForgotStep1() {
            const email = document.getElementById('forgotEmail').value.trim();
            if (!email) return;
            document.getElementById('forgotStep1').classList.add('hidden');
            document.getElementById('forgotStep2').classList.remove('hidden');
        }
        function handleForgotStep2() {
            if (document.getElementById('forgotCode').value === '1234') {
                document.getElementById('forgotStep2').classList.add('hidden');
                document.getElementById('forgotStep3').classList.remove('hidden');
            } else {
                document.getElementById('forgotCode').style.borderColor = '#ef4444';
            }
        }
        async function handleForgotStep3() {
            const np = document.getElementById('newPass').value;
            const cp = document.getElementById('confirmPass').value;
            const err = document.getElementById('forgotPassError');
            if (np.length < 4) { err.textContent = 'Password must be at least 4 characters.'; err.classList.remove('hidden'); return; }
            if (np !== cp) { err.textContent = 'Passwords do not match.'; err.classList.remove('hidden'); return; }
            const hash = await hashPassword(np);
            localStorage.setItem('cspoint_admin_hash', hash);
            localStorage.removeItem('cspoint_admin_pass');
            document.getElementById('forgotStep3').classList.add('hidden');
            document.getElementById('forgotSuccess').classList.remove('hidden');
        }
        function closeForgotModal() {
            document.getElementById('forgotModal').classList.add('hidden');
            document.getElementById('forgotStep1').classList.remove('hidden');
            document.getElementById('forgotStep2').classList.add('hidden');
            document.getElementById('forgotStep3').classList.add('hidden');
            document.getElementById('forgotSuccess').classList.add('hidden');
            document.getElementById('forgotEmail').value = '';
            document.getElementById('forgotCode').value = '';
            document.getElementById('newPass').value = '';
            document.getElementById('confirmPass').value = '';
        }
        function logout() {
            clearTimeout(sessionTimer);
            document.getElementById('dashView').classList.add('hidden');
            document.getElementById('loginView').classList.remove('hidden');
            document.getElementById('loginPass').value = '';
        }

        // ===== TABS =====
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
            document.querySelectorAll('.sidebar-link').forEach(l => { l.classList.remove('active'); if (l.dataset.tab === tab) l.classList.add('active') });
            const titles = { dashboard: 'Dashboard', updates: 'Manage Updates', deadlines: 'Manage Deadlines', resources: 'Manage Resources', links: 'Manage Links' };
            document.getElementById('pageTitle').textContent = titles[tab] || 'Dashboard';
        }

        // ===== MODALS =====
        function openModal(type) { document.getElementById('modal-' + type).classList.remove('hidden') }
        function closeModal(type) {
            document.getElementById('modal-' + type).classList.add('hidden');
            document.getElementById(type + 'Form').reset();
            const editIdMap = { update: 'updateEditId', deadline: 'deadlineEditId', resource: 'resourceEditId', link: 'linkEditId' };
            document.getElementById(editIdMap[type]).value = '';
            const mTitleMap = { update: 'modalUpdateTitle', deadline: 'modalDeadlineTitle', resource: 'modalResourceTitle', link: 'modalLinkTitle' };
            document.getElementById(mTitleMap[type]).textContent = 'Add New ' + type.charAt(0).toUpperCase() + type.slice(1);
        }
        function showToast(msg) {
            const t = document.getElementById('toast'); t.textContent = msg; t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 3000);
        }

        // ===== CATEGORY COLORS =====
        const catColors = { Exams: 'bg-blue-50 text-blue-700', Internship: 'bg-green-50 text-green-700', Workshop: 'bg-purple-50 text-purple-700', Notice: 'bg-gray-100 text-gray-700', Results: 'bg-amber-50 text-amber-700', Contest: 'bg-rose-50 text-rose-700' };
        const statusColors = { 'Open': 'bg-green-50 text-green-700', 'Closing Soon': 'bg-red-50 text-red-700', 'Tomorrow': 'bg-amber-50 text-amber-700', 'Results Out': 'bg-blue-50 text-blue-700' };

        // ===== RENDER =====
        function renderAll() { renderUpdates(); renderDeadlines(); renderResources(); renderLinks(); updateStats(); }

        function renderUpdates() {
            const tb = document.getElementById('updatesBody');
            const empty = document.getElementById('emptyUpdates');
            if (!data.updates.length) { tb.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            tb.innerHTML = data.updates.map(u => {
                const sLink = sanitizeUrl(u.link); const sRegLink = sanitizeUrl(u.regLink); return `<tr>
        <td class="px-4 py-3 font-medium">${escapeHTML(u.title)}</td>
        <td class="px-4 py-3"><span class="px-2 py-0.5 rounded-full text-xs font-bold ${catColors[u.cat] || ''}">${escapeHTML(u.cat)}</span></td>
        <td class="px-4 py-3 text-gray-500">${escapeHTML(u.date)}</td>
        <td class="px-4 py-3">${sLink ? `<a href="${sLink}" target="_blank" rel="noopener noreferrer" class="text-accent hover:underline text-xs">View â†—</a>` : '<span class="text-gray-300 text-xs">â€”</span>'}</td>
        <td class="px-4 py-3">${sRegLink ? `<a href="${sRegLink}" target="_blank" rel="noopener noreferrer" class="text-green-600 hover:underline text-xs font-semibold">Register â†—</a>` : '<span class="text-gray-300 text-xs">â€”</span>'}</td>
        <td class="px-4 py-3 text-right space-x-2">
          <button onclick="editUpdate(${u.id})" class="text-accent hover:text-navy font-medium text-xs">Edit</button>
          <button onclick="deleteItem('updates',${u.id})" class="text-red-400 hover:text-red-600 font-medium text-xs">Delete</button>
        </td></tr>`;
            }).join('');
        }

        function renderDeadlines() {
            const tb = document.getElementById('deadlinesBody');
            const empty = document.getElementById('emptyDeadlines');
            if (!data.deadlines.length) { tb.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            tb.innerHTML = data.deadlines.map(d => {
                const sLink = sanitizeUrl(d.link); return `<tr>
        <td class="px-4 py-3 font-medium">${escapeHTML(d.name)}</td>
        <td class="px-4 py-3 text-gray-500">${escapeHTML(d.date.replace('T', ' '))}</td>
        <td class="px-4 py-3"><span class="px-2 py-0.5 rounded-full text-xs font-bold ${statusColors[d.status] || ''}">${escapeHTML(d.status)}</span></td>
        <td class="px-4 py-3">${sLink ? `<a href="${sLink}" target="_blank" rel="noopener noreferrer" class="text-accent hover:underline text-xs">Register â†—</a>` : '<span class="text-gray-300 text-xs">â€”</span>'}</td>
        <td class="px-4 py-3 text-right space-x-2">
          <button onclick="editDeadline(${d.id})" class="text-accent hover:text-navy font-medium text-xs">Edit</button>
          <button onclick="deleteItem('deadlines',${d.id})" class="text-red-400 hover:text-red-600 font-medium text-xs">Delete</button>
        </td></tr>`;
            }).join('');
        }

        function renderResources() {
            const tb = document.getElementById('resourcesBody');
            const empty = document.getElementById('emptyResources');
            if (!data.resources.length) { tb.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            tb.innerHTML = data.resources.map(r => `<tr>
        <td class="px-4 py-3 font-medium">${escapeHTML(r.name)}</td>
        <td class="px-4 py-3 text-gray-500">${escapeHTML(r.type)}</td>
        <td class="px-4 py-3 text-gray-500">${escapeHTML(r.size) || 'â€”'}</td>
        <td class="px-4 py-3 text-right space-x-2">
          <button onclick="editResource(${r.id})" class="text-accent hover:text-navy font-medium text-xs">Edit</button>
          <button onclick="deleteItem('resources',${r.id})" class="text-red-400 hover:text-red-600 font-medium text-xs">Delete</button>
        </td></tr>`).join('');
        }

        function renderLinks() {
            const tb = document.getElementById('linksBody');
            const empty = document.getElementById('emptyLinks');
            if (!data.links.length) { tb.innerHTML = ''; empty.classList.remove('hidden'); return; }
            empty.classList.add('hidden');
            const linkCatColors = { Official: 'bg-blue-50 text-blue-700', Academic: 'bg-green-50 text-green-700', Social: 'bg-pink-50 text-pink-700', Tool: 'bg-purple-50 text-purple-700', Career: 'bg-amber-50 text-amber-700', Other: 'bg-gray-100 text-gray-700' };
            tb.innerHTML = data.links.map(l => {
                const sUrl = sanitizeUrl(l.url); return `<tr>
        <td class="px-4 py-3 font-medium">${escapeHTML(l.label)}</td>
        <td class="px-4 py-3">${sUrl ? `<a href="${sUrl}" target="_blank" rel="noopener noreferrer" class="text-accent hover:underline text-xs truncate block max-w-[200px]">${escapeHTML(l.url)}</a>` : '<span class="text-gray-300 text-xs">â€”</span>'}</td>
        <td class="px-4 py-3"><span class="px-2 py-0.5 rounded-full text-xs font-bold ${linkCatColors[l.cat] || ''}">${escapeHTML(l.cat)}</span></td>
        <td class="px-4 py-3 text-right space-x-2">
          <button onclick="editLink(${l.id})" class="text-accent hover:text-navy font-medium text-xs">Edit</button>
          <button onclick="deleteItem('links',${l.id})" class="text-red-400 hover:text-red-600 font-medium text-xs">Delete</button>
        </td></tr>`;
            }).join('');
        }

        function updateStats() {
            document.getElementById('statUpdates').textContent = data.updates.length;
            document.getElementById('statDeadlines').textContent = data.deadlines.length;
            document.getElementById('statResources').textContent = data.resources.length;
            document.getElementById('statLinks').textContent = data.links.length;
        }

        // ===== CRUD: UPDATES =====
        document.getElementById('updateForm').addEventListener('submit', e => {
            e.preventDefault();
            const editId = document.getElementById('updateEditId').value;
            const item = { title: validateLength(document.getElementById('uTitle').value, 200), desc: validateLength(document.getElementById('uDesc').value, 1000), cat: validateLength(document.getElementById('uCat').value, 50), date: document.getElementById('uDate').value, link: sanitizeUrl(document.getElementById('uLink').value), regLink: sanitizeUrl(document.getElementById('uRegLink').value) };
            if (editId) { const idx = data.updates.findIndex(u => u.id == editId); if (idx > -1) data.updates[idx] = { ...data.updates[idx], ...item }; showToast('Update edited successfully!'); }
            else { item.id = nextId.updates++; data.updates.unshift(item); showToast('Update added successfully!'); }
            saveData(); closeModal('update'); renderAll();
        });
        function editUpdate(id) {
            const u = data.updates.find(x => x.id === id); if (!u) return;
            document.getElementById('updateEditId').value = id;
            document.getElementById('uTitle').value = u.title;
            document.getElementById('uDesc').value = u.desc || '';
            document.getElementById('uCat').value = u.cat;
            document.getElementById('uDate').value = u.date;
            document.getElementById('uLink').value = u.link || '';
            document.getElementById('uRegLink').value = u.regLink || '';
            document.getElementById('modalUpdateTitle').textContent = 'Edit Update';
            openModal('update');
        }

        // ===== CRUD: DEADLINES =====
        document.getElementById('deadlineForm').addEventListener('submit', e => {
            e.preventDefault();
            const editId = document.getElementById('deadlineEditId').value;
            const item = { name: validateLength(document.getElementById('dName').value, 200), date: document.getElementById('dDate').value, status: validateLength(document.getElementById('dStatus').value, 50), link: sanitizeUrl(document.getElementById('dLink').value) };
            if (editId) { const idx = data.deadlines.findIndex(d => d.id == editId); if (idx > -1) data.deadlines[idx] = { ...data.deadlines[idx], ...item }; showToast('Deadline edited!'); }
            else { item.id = nextId.deadlines++; data.deadlines.unshift(item); showToast('Deadline added!'); }
            saveData(); closeModal('deadline'); renderAll();
        });
        function editDeadline(id) {
            const d = data.deadlines.find(x => x.id === id); if (!d) return;
            document.getElementById('deadlineEditId').value = id;
            document.getElementById('dName').value = d.name;
            document.getElementById('dDate').value = d.date;
            document.getElementById('dStatus').value = d.status;
            document.getElementById('dLink').value = d.link || '';
            document.getElementById('modalDeadlineTitle').textContent = 'Edit Deadline';
            openModal('deadline');
        }

        // ===== CRUD: RESOURCES =====
        document.getElementById('resourceForm').addEventListener('submit', e => {
            e.preventDefault();
            const editId = document.getElementById('resourceEditId').value;
            const item = { name: validateLength(document.getElementById('rName').value, 200), type: validateLength(document.getElementById('rType').value, 50), size: validateLength(document.getElementById('rSize').value, 50) };
            if (editId) { const idx = data.resources.findIndex(r => r.id == editId); if (idx > -1) data.resources[idx] = { ...data.resources[idx], ...item }; showToast('Resource edited!'); }
            else { item.id = nextId.resources++; data.resources.unshift(item); showToast('Resource added!'); }
            saveData(); closeModal('resource'); renderAll();
        });
        function editResource(id) {
            const r = data.resources.find(x => x.id === id); if (!r) return;
            document.getElementById('resourceEditId').value = id;
            document.getElementById('rName').value = r.name;
            document.getElementById('rType').value = r.type;
            document.getElementById('rSize').value = r.size || '';
            document.getElementById('modalResourceTitle').textContent = 'Edit Resource';
            openModal('resource');
        }

        // ===== CRUD: LINKS =====
        document.getElementById('linkForm').addEventListener('submit', e => {
            e.preventDefault();
            const editId = document.getElementById('linkEditId').value;
            const item = { label: validateLength(document.getElementById('lLabel').value, 200), url: sanitizeUrl(document.getElementById('lUrl').value), cat: validateLength(document.getElementById('lCat').value, 50), desc: validateLength(document.getElementById('lDesc').value, 500) };
            if (editId) { const idx = data.links.findIndex(l => l.id == editId); if (idx > -1) data.links[idx] = { ...data.links[idx], ...item }; showToast('Link edited!'); }
            else { item.id = nextId.links++; data.links.unshift(item); showToast('Link added!'); }
            saveData(); closeModal('link'); renderAll();
        });
        function editLink(id) {
            const l = data.links.find(x => x.id === id); if (!l) return;
            document.getElementById('linkEditId').value = id;
            document.getElementById('lLabel').value = l.label;
            document.getElementById('lUrl').value = l.url;
            document.getElementById('lCat').value = l.cat;
            document.getElementById('lDesc').value = l.desc || '';
            document.getElementById('modalLinkTitle').textContent = 'Edit Link';
            openModal('link');
        }

        // ===== DELETE =====
        function deleteItem(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            data[type] = data[type].filter(x => x.id !== id);
            saveData();
            showToast('Item deleted.');
            renderAll();
        }
    </script>
</body>

</html>